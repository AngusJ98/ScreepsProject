{"code":"import { Roles, Setups } from \"Creep_Setups/Setups\";\r\nimport { Manager } from \"Manager\";\r\nimport { CapitalSize } from \"Room/Capital\";\r\nimport { ManagerPriority } from \"./ManagerPriority\";\r\nexport class WorkManager extends Manager {\r\n    constructor(capital, prio = ManagerPriority.Capital.work) {\r\n        super(capital, \"WorkManager_\" + capital.name, prio);\r\n        this.barrierHits = {\r\n            1: 3e+3,\r\n            2: 3e+3,\r\n            3: 1e+4,\r\n            4: 5e+4,\r\n            5: 1e+5,\r\n            6: 5e+5,\r\n            7: 1e+6,\r\n            8: 2e+7,\r\n        };\r\n        this.critical = 2500;\r\n        this.tolerance = 100000;\r\n        this.fortifyThreshold = 500000;\r\n        this.workers = this.creepsByRole[Roles.worker];\r\n        this.setup = this.capital.level == 1 ? Setups.workers.early : Setups.workers.default;\r\n        this.room = capital.room;\r\n        this.hitsGoal = this.barrierHits[this.capital.level];\r\n        this.fortifyTargets = _.filter(this.room.barriers, r => r.hits < this.hitsGoal);\r\n        this.criticalTargets = _.filter(this.fortifyTargets, r => r.hits < this.critical);\r\n        this.repairTargets = _.filter(this.capital.repairables);\r\n        this.constructionSites = this.capital.constructionSites;\r\n    }\r\n    buildActions(worker) {\r\n        let target = worker.pos.findClosestByMultiRoomRange(this.constructionSites);\r\n        if (target) {\r\n            worker.goBuild(target);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    repairActions(worker) {\r\n        let target = worker.pos.findClosestByMultiRoomRange(this.repairTargets);\r\n        if (target) {\r\n            worker.goRepair(target);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    fortifyActions(worker, targets) {\r\n        if (targets.length == 0) {\r\n            return false;\r\n        }\r\n        let lowTargets;\r\n        let lowestHits = _.min(_.map(targets, r => r.hits));\r\n        lowTargets = _.take(_.filter(targets, r => r.hits <= lowestHits + this.tolerance), 5);\r\n        let target = worker.pos.findClosestByMultiRoomRange(lowTargets);\r\n        if (target) {\r\n            worker.goRepair(target);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    upgradeActions(worker) {\r\n        var _a;\r\n        let target = this.capital.controller;\r\n        if (!((_a = this.capital.controller.sign) === null || _a === void 0 ? void 0 : _a.text) == config.signature) {\r\n            worker.goSign(this.capital.controller);\r\n            return true;\r\n        }\r\n        else {\r\n            worker.goUpgrade(target);\r\n            return true;\r\n        }\r\n    }\r\n    handleWorker(worker) {\r\n        if (worker.store.energy > 0) {\r\n            if (this.capital.controller.ticksToDowngrade <= (this.capital.level >= 4 ? 8000 : 2000)) {\r\n                if (this.upgradeActions(worker))\r\n                    return;\r\n            }\r\n            if (this.repairTargets.length > 0) {\r\n                if (this.repairActions(worker))\r\n                    return;\r\n            }\r\n            // Fortify critical barriers\r\n            if (this.criticalTargets.length > 0) {\r\n                if (this.fortifyActions(worker, this.criticalTargets))\r\n                    return;\r\n            }\r\n            // Build new structures\r\n            if (this.constructionSites.length > 0) {\r\n                if (this.buildActions(worker))\r\n                    return;\r\n            }\r\n            if (this.fortifyTargets.length > 0) {\r\n                if (this.fortifyActions(worker, this.fortifyTargets))\r\n                    return;\r\n            }\r\n            if (this.capital.level < 8 || this.capital.creepsByRole[Roles.upgrader].length == 0) {\r\n                if (this.upgradeActions(worker))\r\n                    return;\r\n            }\r\n            worker.say(\"BORED!\");\r\n        }\r\n        else {\r\n            let target = worker.pos.findClosestByRange(_.filter(this.capital.room.storageUnits, r => r.store.energy > worker.store.getCapacity() / 4));\r\n            if (target) {\r\n                worker.goWithdraw(target);\r\n            }\r\n        }\r\n    }\r\n    init() {\r\n        var _a;\r\n        let currentParts = this.setup.getBodyPotential(WORK, this.capital);\r\n        let numWorkers = 0;\r\n        if (this.capital.stage = CapitalSize.Town) {\r\n            let MAX_WORKERS = 10;\r\n            numWorkers = 3;\r\n        }\r\n        else {\r\n            let MAX_WORKERS = 5;\r\n            let repairTicks = _.sum(this.repairTargets, r => r.hitsMax - r.hits) / REPAIR_POWER;\r\n            let buildTicks = _.sum(this.constructionSites, r => (r.progressTotal - r.progress) / BUILD_POWER);\r\n            let fortifyTicks = 0;\r\n            if ((((_a = this.capital.storage) === null || _a === void 0 ? void 0 : _a.store.energy) || 0) + _.sum(this.capital.containers, r => r.store.energy) >= this.fortifyThreshold) {\r\n                fortifyTicks = 0.2 * _.sum(this.fortifyTargets, r => Math.max(0, this.hitsGoal - r.hits)); //take a fraction of how many barriers need fortifying\r\n            }\r\n            numWorkers = Math.ceil(2 * (5 * buildTicks + repairTicks + fortifyTicks) / currentParts * CREEP_LIFE_TIME);\r\n            numWorkers = Math.min(numWorkers, MAX_WORKERS);\r\n        }\r\n        this.spawnList(numWorkers, this.setup);\r\n    }\r\n    run() {\r\n    }\r\n}\r\n//# sourceMappingURL=WorkManager.js.map","references":["C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Creep_Setups/CreepSetup.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Creep_Setups/Setups.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Manager.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Room/Capital.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Managers/ManagerPriority.ts"],"map":"{\"version\":3,\"file\":\"WorkManager.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/Managers/WorkManager.ts\"],\"names\":[],\"mappings\":\"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\"}"}
