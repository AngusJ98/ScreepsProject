{"code":"//capitals are our claimed rooms. All managers will be assigned to a capital. This allows managers to spawn creeps\r\n//for other rooms to use and manager military code\r\nimport { Artillery } from \"Buildings/Artillery\";\r\nimport { Barracks } from \"Buildings/Barracks\";\r\nimport { LorryHQ } from \"Buildings/LorryHQ\";\r\nimport { MiningSite } from \"Buildings/MiningSite\";\r\nimport { ReserveSite } from \"Buildings/ReserveSite\";\r\nimport { UpgradeSite } from \"Buildings/UpgradeSite\";\r\nimport { Roles } from \"Creep_Setups/Setups\";\r\nimport { WorkManager } from \"Managers/WorkManager\";\r\nexport var CapitalSize;\r\n(function (CapitalSize) {\r\n    CapitalSize[CapitalSize[\"Town\"] = 0] = \"Town\";\r\n    CapitalSize[CapitalSize[\"City\"] = 1] = \"City\";\r\n    CapitalSize[CapitalSize[\"Megacity\"] = 2] = \"Megacity\";\r\n})(CapitalSize || (CapitalSize = {}));\r\nexport class Capital {\r\n    constructor(room, empire) {\r\n        this.empire = empire;\r\n        this.name = room.name;\r\n        Memory.capitals[this.name] = { outposts: [\"W59N4\"] };\r\n        this.capital = this;\r\n        this.room = room;\r\n        this.observer = this.room.observer;\r\n        let outpostNames = Memory.capitals[this.name].outposts;\r\n        let invisRooms = _.filter(outpostNames, r => !Game.rooms[r]);\r\n        if (invisRooms.length > 0 && this.observer) {\r\n            this.observer.observeRoom(invisRooms[0]);\r\n        }\r\n        this.outposts = _.compact(_.map(outpostNames, r => Game.rooms[r]));\r\n        this.allRooms = this.outposts.concat([this.room]);\r\n        this.roomNames = _.map(this.allRooms, r => r.name);\r\n        this.controller = this.room.controller;\r\n        this.pos = this.controller.pos;\r\n        this.spawns = _.filter(this.room.spawns, spawn => spawn.my);\r\n        this.coreSpawn = this.spawns[0]; //TODO FIX\r\n        this.extensions = this.room.extensions;\r\n        this.storage = this.room.storage;\r\n        this.links = this.room.links;\r\n        this.availableLinks = _.clone(this.links);\r\n        this.terminal = this.room.terminal;\r\n        this.towers = this.room.towers;\r\n        this.labs = this.room.labs;\r\n        this.powerSpawn = this.room.powerSpawn;\r\n        this.nuker = this.room.nuker;\r\n        this.containers = this.room.containers;\r\n        this.ಠ_ಠ = 0;\r\n        this.level = this.controller.level;\r\n        if (this.storage && this.storage.isActive() && this.spawns[0]) {\r\n            if (this.level == 8) {\r\n                this.stage = CapitalSize.Megacity;\r\n            }\r\n            else {\r\n                this.stage = CapitalSize.City;\r\n            }\r\n        }\r\n        else {\r\n            this.stage = CapitalSize.Town;\r\n        }\r\n        this.sources = _.compact(_.flatten(_.map(this.allRooms, room => room.sources))); //all sources, including those in outposts\r\n        this.constructionSites = _.flatten(_.map(this.allRooms, room => room.constructionSites)); //all construction sites\r\n        this.repairables = _.flatten(_.map(this.allRooms, room => room.repairables)); // all objects needing repair\r\n        this.creeps = empire.creepsByCapital[this.name];\r\n        this.creepsByRole = _.groupBy(this.creeps, r => r.memory.role);\r\n        for (let role in Roles) {\r\n            if (!this.creepsByRole[role]) {\r\n                this.creepsByRole[role] = [];\r\n            }\r\n        }\r\n        this.creepsByManager = _.groupBy(this.creeps, r => r.memory.manager);\r\n        this.hostiles = _.flatten(_.map(this.allRooms, room => room.hostiles)); //hostile creeps in all rooms\r\n        this.miningSites = [];\r\n        this.reserveSites = [];\r\n        this.barracks = undefined;\r\n        this.buildings = [];\r\n        this.buildingsByContainer = {};\r\n        this.managers = [];\r\n        this.workManager = new WorkManager(this);\r\n        this.assets = this.getAssets();\r\n        this.createBuildings();\r\n    }\r\n    //Method to start all buildings\r\n    createBuildings() {\r\n        if (this.coreSpawn) {\r\n            this.barracks = new Barracks(this, this.spawns[0]);\r\n            //console.log(this.barracks.name)\r\n        }\r\n        else {\r\n            console.log(\"no spawn in \" + this.room.name);\r\n        }\r\n        for (let source of this.sources) {\r\n            //console.log(source)\r\n            let site = new MiningSite(this, source);\r\n            this.miningSites.push(site);\r\n        }\r\n        if (this.towers[0]) {\r\n            this.artillery = new Artillery(this, this.towers[0]);\r\n        }\r\n        this.upgradeSite = new UpgradeSite(this, this.controller);\r\n        if (this.storage) {\r\n            this.lorryHQ = new LorryHQ(this, this.storage);\r\n        }\r\n        for (let outpost of this.outposts) {\r\n            if (outpost.controller) {\r\n                this.reserveSites.push(new ReserveSite(this, outpost.controller));\r\n            }\r\n        }\r\n    }\r\n    //God I hope this works\r\n    getAssets() {\r\n        let stores = _.map(_.compact([this.storage, this.terminal]), r => r.store);\r\n        let creepCarries = _.map(this.creeps, creep => creep.store);\r\n        let combined = stores.concat(creepCarries);\r\n        var ret = {};\r\n        for (let store of combined) {\r\n            for (let key in store) {\r\n                let amount = store[key] || 0;\r\n                if (!ret[key]) {\r\n                    ret[key] = 0;\r\n                }\r\n                ret[key] += amount;\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    init() {\r\n        this.room.memory.lastSeen = Game.time;\r\n        //_.forEach(this.managers, r => console.log(r.name))\r\n        _.forEach(this.buildings, r => r.init());\r\n        //_.forEach(this.managers, r => console.log(r.name))\r\n        //_.forEach(this.buildings, r => console.log(r.name))\r\n        _.forEach(this.managers, r => r.init());\r\n    }\r\n    run() {\r\n        _.forEach(this.managers, r => r.run());\r\n        _.forEach(this.buildings, r => r.run());\r\n    }\r\n}\r\n//# sourceMappingURL=Capital.js.map","references":["C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/Artillery.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/Barracks.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/Building.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/LorryHQ.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/MiningSite.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/ReserveSite.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Buildings/UpgradeSite.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Creep_Setups/Setups.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Empire.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Manager.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Managers/WorkManager.ts","C:/Users/ADMIN BOI/Documents/GitHub/ScreepsProject/src/Room/Room_Find.ts"],"map":"{\"version\":3,\"file\":\"Capital.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/Room/Capital.ts\"],\"names\":[],\"mappings\":\"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\"}"}
